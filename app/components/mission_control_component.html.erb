<div class="space-y-8">
  <!-- Actions -->
  <div class="flex flex-wrap gap-4">
    <%= button_to "üîÑ Sync Holdings", mission_control_sync_holdings_now_path, method: :post, class: "bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg font-semibold transition" %>
    <%= button_to "üí≥ Sync Transactions", mission_control_sync_transactions_now_path, method: :post, class: "bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg font-semibold transition" %>
    <%= button_to "üí∞ Sync Liabilities", mission_control_sync_liabilities_now_path, method: :post, class: "bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg font-semibold transition" %>
    <%= button_to "üöÄ Refresh Everything", mission_control_refresh_everything_now_path, method: :post, class: "bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition" %>
    <%= button_to "üí£ Nuke All Data", mission_control_nuke_path, method: :post, data: { confirm: "Delete ALL Plaid data? (cost history preserved)" }, class: "bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition" %>
  </div>

  <!-- Plaid Items -->
  <div>
    <h3 class="text-2xl font-bold text-primary-400 mb-4">Plaid Items (<%= @plaid_items.count %>)</h3>
    <% if @plaid_items.any? %>
      <div class="bg-slate-800 rounded-lg overflow-hidden border border-slate-700">
        <table class="w-full">
          <thead class="bg-slate-700">
            <tr>
              <th class="px-4 py-3 text-left">Institution</th>
              <th class="px-4 py-3 text-left">Status</th>
              <th class="px-4 py-3 text-left">Accounts</th>
              <th class="px-4 py-3 text-left">Holdings</th>
              <th class="px-4 py-3 text-left">Last Synced</th>
              <th class="px-4 py-3 text-left">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-700">
            <% @plaid_items.each do |item| %>
              <tr class="hover:bg-slate-700/50">
                <td class="px-4 py-3"><%= item.institution_name %></td>
                <td class="px-4 py-3">
                  <span class="px-2 py-1 rounded text-sm <%= item.status == 'good' ? 'bg-green-600' : 'bg-red-600' %>">
                    <%= item.status.humanize %>
                  </span>
                </td>
                <td class="px-4 py-3"><%= item.accounts.count %></td>
                <td class="px-4 py-3"><%= item.holdings.count %></td>
                <td class="px-4 py-3 text-sm text-slate-400">
                  <%= item.holdings_synced_at&.strftime("%Y-%m-%d %H:%M") || "Never" %>
                </td>
                <td class="px-4 py-3">
                  <%= button_to "Remove", mission_control_remove_item_path(item), method: :post, data: { confirm: "Remove this item and all associated data?" }, class: "bg-red-600 hover:bg-red-700 text-white text-sm px-3 py-1 rounded transition" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-slate-400">No Plaid items yet.</p>
    <% end %>
  </div>

  <!-- Holdings -->
  <div>
    <h3 class="text-2xl font-bold text-primary-400 mb-4">Holdings (<%= @holdings.count %>)</h3>
    <% if @holdings.any? %>
      <div class="bg-slate-800 rounded-lg overflow-hidden border border-slate-700">
        <table class="w-full text-sm">
          <thead class="bg-slate-700">
            <tr>
              <th class="px-4 py-3 text-left">Symbol</th>
              <th class="px-4 py-3 text-left">Name</th>
              <th class="px-4 py-3 text-right">Quantity</th>
              <th class="px-4 py-3 text-right">Market Value</th>
              <th class="px-4 py-3 text-left">Account</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-700">
            <% @holdings.each do |holding| %>
              <tr class="hover:bg-slate-700/50">
                <td class="px-4 py-3 font-semibold"><%= holding.symbol %></td>
                <td class="px-4 py-3"><%= holding.name %></td>
                <td class="px-4 py-3 text-right"><%= number_with_delimiter(holding.quantity) %></td>
                <td class="px-4 py-3 text-right"><%= number_to_currency(holding.market_value) if holding.market_value %></td>
                <td class="px-4 py-3"><%= holding.account&.name || holding.account&.account_id %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-slate-400">No holdings yet. Link a Plaid item and sync holdings.</p>
    <% end %>
  </div>

  <!-- Liabilities -->
  <div>
    <h3 class="text-2xl font-bold text-primary-400 mb-4">Liabilities</h3>
    <% liability_accounts = @accounts.select { |a| a.respond_to?(:apr_percentage) && (a.apr_percentage.present? || a.min_payment_amount.present?) } %>
    <% if liability_accounts.any? %>
      <div class="bg-slate-800 rounded-lg overflow-hidden border border-slate-700">
        <table class="w-full text-sm">
          <thead class="bg-slate-700">
            <tr>
              <th class="px-4 py-3 text-left">Account</th>
              <th class="px-4 py-3 text-right">Min Payment</th>
              <th class="px-4 py-3 text-right">APR %</th>
              <th class="px-4 py-3 text-left">Due Date</th>
              <th class="px-4 py-3 text-center">Overdue?</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-700">
            <% liability_accounts.each do |account| %>
              <tr class="hover:bg-slate-700/50">
                <td class="px-4 py-3"><%= account.name || account.account_id %></td>
                <td class="px-4 py-3 text-right"><%= number_to_currency(account.min_payment_amount) if account.min_payment_amount %></td>
                <td class="px-4 py-3 text-right"><%= account.apr_percentage ? "#{account.apr_percentage}%" : '-' %></td>
                <td class="px-4 py-3"><%= account.next_payment_due_date || '-' %></td>
                <td class="px-4 py-3 text-center">
                  <%= account.is_overdue ? '<span class="text-red-400">‚ö†Ô∏è YES</span>'.html_safe : '<span class="text-green-400">No</span>'.html_safe %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-slate-400">No liabilities yet. Click "Sync Liabilities" to fetch data.</p>
    <% end %>
  </div>

  <!-- Sync Logs (PRD UI-3) -->
  <div>
    <h3 class="text-2xl font-bold text-primary-400 mb-4">Sync Logs (<%= @sync_logs.total_count %>)</h3>

    <!-- Filters -->
    <div class="mb-6 bg-slate-800 p-4 rounded-lg border border-slate-700">
      <%= form_with url: mission_control_path, method: :get, local: true, class: "grid grid-cols-1 md:grid-cols-4 gap-4" do |f| %>
        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">Job Type</label>
          <%= f.select :job_type,
              options_for_select([
                ["All Types", ""],
                ["Holdings", "holdings"],
                ["Transactions", "transactions"],
                ["Liabilities", "liabilities"]
              ], params[:job_type]),
              {},
              class: "w-full bg-slate-700 border border-slate-600 text-white rounded-md p-2 focus:ring-primary-500 focus:border-primary-500" %>
        </div>

        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">Status</label>
          <%= f.select :status,
              options_for_select([
                ["All Statuses", ""],
                ["Success", "success"],
                ["Failure", "failure"],
                ["Started", "started"]
              ], params[:status]),
              {},
              class: "w-full bg-slate-700 border border-slate-600 text-white rounded-md p-2 focus:ring-primary-500 focus:border-primary-500" %>
        </div>

        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">Start Date</label>
          <%= f.date_field :start_date, value: params[:start_date], class: "w-full bg-slate-700 border border-slate-600 text-white rounded-md p-2 focus:ring-primary-500 focus:border-primary-500" %>
        </div>

        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">End Date</label>
          <%= f.date_field :end_date, value: params[:end_date], class: "w-full bg-slate-700 border border-slate-600 text-white rounded-md p-2 focus:ring-primary-500 focus:border-primary-500" %>
        </div>

        <div class="md:col-span-4 flex gap-3">
          <%= f.submit "Apply Filters", class: "bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-6 rounded cursor-pointer transition" %>
          <% if params[:job_type].present? || params[:status].present? || params[:start_date].present? || params[:end_date].present? %>
            <%= link_to "Clear Filters", mission_control_path, class: "bg-slate-600 hover:bg-slate-500 text-white font-medium py-2 px-6 rounded transition" %>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Logs Table -->
    <% if @sync_logs.any? %>
      <div class="bg-slate-800 rounded-lg overflow-hidden border border-slate-700">
        <table class="w-full text-sm">
          <thead class="bg-slate-700">
            <tr>
              <th class="px-4 py-3 text-left">Time</th>
              <th class="px-4 py-3 text-left">Institution</th>
              <th class="px-4 py-3 text-left">Job Type</th>
              <th class="px-4 py-3 text-left">Status</th>
              <th class="px-4 py-3 text-left">Error</th>
              <th class="px-4 py-3 text-left">Job ID</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-700">
            <% @sync_logs.each do |log| %>
              <tr class="hover:bg-slate-700/50">
                <td class="px-4 py-3 text-slate-300">
                  <%= log.created_at.strftime("%Y-%m-%d %H:%M:%S") %>
                </td>
                <td class="px-4 py-3">
                  <%= log.plaid_item&.institution_name || "N/A" %>
                </td>
                <td class="px-4 py-3">
                  <span class="px-2 py-1 rounded text-xs bg-slate-600">
                    <%= log.job_type %>
                  </span>
                </td>
                <td class="px-4 py-3">
                  <% if log.status == "success" %>
                    <span class="px-2 py-1 rounded text-xs bg-green-600">‚úì Success</span>
                  <% elsif log.status == "failure" %>
                    <span class="px-2 py-1 rounded text-xs bg-red-600">‚úó Failure</span>
                  <% elsif log.status == "started" %>
                    <span class="px-2 py-1 rounded text-xs bg-blue-600">‚ü≥ Started</span>
                  <% else %>
                    <span class="px-2 py-1 rounded text-xs bg-slate-600"><%= log.status %></span>
                  <% end %>
                </td>
                <td class="px-4 py-3 text-slate-400 max-w-xs truncate">
                  <%= log.error_message || "-" %>
                </td>
                <td class="px-4 py-3 text-slate-500 font-mono text-xs">
                  <%= log.job_id&.first(8) || "-" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="mt-6 flex justify-center">
        <%= helpers.paginate @sync_logs %>
      </div>
    <% else %>
      <p class="text-slate-400">No sync logs found. Run a sync operation to see logs here.</p>
    <% end %>
  </div>
</div>
