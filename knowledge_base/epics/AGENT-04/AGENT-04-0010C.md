### PRD 0010C: Controls in Gear Menu & Heartbeat

**Goal**: Integrate per-run overrides (model/token/iter) and Heartbeat probe into the gear menu—enabling tweaks and health checks before starts.

**Scope**: Populate gear dropdown with form inputs; add Heartbeat button/endpoint for LLM probe.

**Out of Scope**: Streaming/polling (0010B); audit/artifacts (0010D).

**Requirements**:
1) **Gear Controls & Model Mapping**: Gear opens as slide-over drawer on desktop (dropdown ok on mobile). Provide model select with env-specific mapping (Ollama → llama3.1:70b dev / llama3.1:405b prod; Grok → grok-4.1; Claude → claude-sonnet-3.5). If chosen model unavailable, banner "Model down—switching to Ollama" and fallback to Ollama mapping. Number inputs for token limit/max iterations (defaults 1000/5); overrides stored per session (session[:sap_controls]) and reset on "New Task".
2) **Preset Buttons**: Include quick preset buttons (e.g., "Fast Draft" = Ollama + token 1000 + 5 iterations) that populate the controls; apply on close and pass to start params.
3) **Heartbeat Button & Throttle**: In gear, button POST /sap_heartbeat {model} → probe "2+2?"; return JSON {alive, response, latency, error}. Throttle heartbeats to 1/min per session with JS debounce to avoid provider limits.
4) **Feedback**: Banner bubble on probe (green "Alive: 1.8s" or red "Down: timeout") and on model fallback (e.g., "Model down—switching to Ollama").
5) **Rails Guidance**: Stimulus for menu open/close/apply + preset handling; slide-over/drawer component on desktop; service SapAgent.heartbeat(model) for probe (real LLM call); persist overrides in session store.

**Architectural Context**: Model override via SmartProxy; vision.md: no mocks, real probes.

**Acceptance Criteria**:
- Open gear slide-over → set token=4000 (or use "Fast Draft" preset) → submit run uses it; mapping applies per env.
- Click Heartbeat on Grok/Claude/Ollama respecting 1/min throttle → green/red banner with latency and fallback banner if model down.
- Overrides persist per session until "New Task" is clicked, which clears them.

**Manual Test Plan**:
0) Prep: Ensure `.env.testing` covers live-proxy/ports for opt-in runs.
1) Click gear (slide-over on desktop) → select Grok, set token=3000, iter=6 or click "Fast Draft" preset → close → start run (confirm override in logs and applied mapping for env).
2) Switch model to unavailable value (simulate failure) → see banner "Model down—switching to Ollama" and confirm fallback mapping on submit.
3) Gear → Heartbeat → see banner "Alive: latency X" or error; attempt another heartbeat within 60s and confirm throttle debounces request.
4) Start a run, then click "New Task" → overrides reset; reopen gear to confirm defaults restored.

**Deliverables**: Gear slide-over/dropdown partial with preset buttons; Heartbeat endpoint/service with debounce guard; session-backed overrides with reset on New Task; mapping/fallback banners; banner rendering.