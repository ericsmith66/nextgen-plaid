### PRD 0010D: Audit Sidebar & Artifacts

**Goal**: Add persistent audit history in a collapsible sidebar and artifact links/downloads—completing oversight with tracking.

**Scope**: SapRun model for persistence; sidebar table; artifact handling (links/inline).

**Out of Scope**: Layout/streaming/controls (0010A-C).

**Requirements**:
1) **SapRun Model**: Migration with fields (user:references, task, status enum, phase, model_used, correlation_id, idempotency_uuid, output_json:jsonb, artifact_path, resume_token, error_message, started_at/completed_at).
2) **Audit Surface**: DaisyUI drawer/sidebar on desktop; modal presentation on mobile with table (recent runs: timestamp, redacted user, status, model, correlation_id, result); Kaminari pagination.
3) **Artifacts**: If artifact_path, <a href="/downloads/:path" class="btn">Download</a> (send_file); else inline humanized output_json (RAG summary).
4) **Rails Guidance**: Scope SapRun.recent.order(started_at: :desc).page(params[:page}); Redactor on output/error before save/display.
5) **State & Controls**: Enforce SapRun state machine (idle/running/paused/error/complete) with atomic status updates; pause/resume buttons enabled only for valid transitions to avoid drift. Keep resume_token internal-only (stored but not exposed in UI/audit).
6) **Retention**: Add pruning cron that deletes SapRun rows/artifacts older than 30 days; emit metric/log on deletions.

**Architectural Context**: DB persistence for restarts; vision.md: redacted PII, English summaries.

**Acceptance Criteria**:
- Complete run → new SapRun row; sidebar lists with redacted details (desktop) or modal shows details (mobile).
- Artifact path → download link works; no path → inline summary.
- Pagination: >10 runs → pages load.
- Pause/resume controls obey state machine (idle/running/paused/error/complete) with atomic updates; resume_token never shown in UI.
- Retention cron removes runs >30 days and logs metric.

**Manual Test Plan**:
0) Prep: Ensure `.env.testing` reflects live-proxy settings for audit coverage when running against real proxy.
1) Start/pause/resume run → sidebar (desktop) or modal (mobile) shows row with status/correlation; verify buttons disable/enable per state.
2) Run with artifact → click link → downloads file.
3) Error run or proxy down → see failed status/error message (humanized) in audit entry; resume_token not displayed.
4) Simulate cron (rake task) for retention → runs older than 30 days pruned; log/metric emitted.

**Deliverables**: SapRun model/migration; sidebar/modal partial/table; download controller/action; state machine/atomic update guard for SapRun; retention cron/task with logging; UI hides resume_token.