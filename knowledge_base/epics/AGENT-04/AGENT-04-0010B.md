### PRD 0010B: Streaming via Turbo/Polling

**Goal**: Add dynamic streaming feedback by implementing a polling endpoint and appending message bubbles for prompts, responses, tokens, and phases—providing live visibility into runs.

**Scope**: Create poll endpoint; use Turbo to append chat bubbles incrementally from JSON chunks.

**Out of Scope**: Form controls/Heartbeat (0010C); audit/artifacts (0010D); LLM probes.

**Requirements**:
1) **Polling Endpoint**: GET /sap_runs/:correlation_id/status → JSON {phase, prompt, response, tokens: {used, remaining}, error?, correlation_id}. Source token usage from SapAgent estimates; prefix all poll responses/events/logs with correlation_id and log reconciliations against SmartProxy metrics.
2) **Bubble Append**: Use <turbo-frame id="chat-stream"> with standardized BubbleComponent types (user/system/agent/error/token/phase); append daisyui-chat-bubble with expandable token/phase badges and per-bubble "Show raw" toggle for JSON payloads (humanize via RAG if error).
3) **Auto-Scroll**: JS in Stimulus: after append, scrollTop = scrollHeight.
4) **Polling Strategy & Backoff**: Default poll every 3s with visible indicator (banner "Polling every Xs..."); on failures apply exponential backoff (3s → 5s → 10s) with retry banner "Retrying in Xs..."; reset to fast cadence when healthy.
5) **Streaming Transport**: Prefer Turbo Streams broadcast_to correlation_id; provide optional SSE endpoint with identical payload schema if Turbo proves flaky; fallback to polling automatically.
6) **In-Stream Error UX**: LLM/proxy downtime emits in-stream error bubbles (with correlation_id and actionable text, e.g., "Retry"/"Switch model") instead of console-only errors.
7) **Observability**: Log poll attempts/responses/latency with correlation_id prefix; add hooks around append/scroll to aid live-proxy debugging.

**Architectural Context**: Polling default (no ActionCable); vision.md: quick feedback, resilient.

**Acceptance Criteria**:
- Start run → bubbles append incrementally (phase/prompt/response/tokens) using standardized bubble types and token/phase badges.
- Error chunk or downtime → red bubble with humanized message plus actionable text (e.g., retry/switch model) showing correlation_id.
- Auto-scroll keeps latest visible.
- Polling indicator shows current cadence; failure triggers backoff banner (3s→5s→10s) then recovers to normal cadence.
- Per-bubble "Show raw" toggle reveals JSON payload; SSE optional path matches polling payload.
- Logs/events are correlation-first (poll/append) with token usage sourced from SapAgent and reconciliation notes.

**Manual Test Plan**:
0) Prep: Ensure `.env.testing` contains live-proxy host/ports for opt-in runs.
1) Start task with overrides from gear (model/tokens/iterations) → wait 8s → see 2+ bubbles (phase/prompt/response) with token badge; indicator shows polling cadence.
2) Toggle "Show raw" on an agent bubble → JSON payload appears; collapse hides it.
3) Trigger error or proxy down → see red bubble with correlation_id and actionable text; observe retry banner (3s→5s→10s) then recovery to normal polling.
4) Scroll up mid-run → auto-snaps to bottom on new bubble (indicator still visible); verify logs show correlation_id prefixes and token reconciliation note.

**Deliverables**: Polling controller/endpoint; Turbo partials for bubbles; Stimulus updates for poll/append/scroll/backoff/indicator; optional SSE endpoint; BubbleComponent usage with token badges + raw toggle; observability/log hooks (correlation_id-prefixed) for poll/append/reconciliation.