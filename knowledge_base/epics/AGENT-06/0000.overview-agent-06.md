# Epic 6: Code Writing Agent Build (Agent-06)
### Epic Goal
Build CWA as autonomous implementer with Junie-inspired pillars (dynamic tools, traces, JSON, checkpoints, failures)—for code gen, self-debug, tests, commits. Integrate as custom agent in chatwoot/ai-agents gem from Epic 5 (register with tools, handoffs from Planner/Coordinator via context hash).
### Scope
INTP persona from personas.yml; safe shell/toolkit with sandbox; log template; MCP-like tools; self-debug loop; hybrid handoff (CWA drafts/stages commits, human review/push/merge).
### Non-Goals
Full automation (human approve); new LLMs (existing SmartProxy with Ollama/Grok; **Claude ⏳ not yet implemented in SmartProxy**).
### Dependencies
Agent-05 for workflow/PRD handoff; MiniTest/VCR suite; ai-agents gem; AiWorkflowRun model for persistence.
### Risks/Mitigations
Destructive actions → whitelist/out-of-process sandbox + dry-run v1; hallucinations → self-debug with real tests + retries.
### End-of-Epic Capabilities
- CWA implements PRD micro-tasks with whitelisted commands (e.g., `rails g`, `bundle exec rake test`, `git add/commit`). **No `rm` in v1.**
- Self-debug: Runs MiniTest/VCR + rubocop/brakeman, parses logs, fixes/retries up to 2x.
- Logs in 12-section template (plan/execute/test/retry etc.), persisted in events.ndjson + committed with drafts.
- Hybrid: CWA drafts → hands back for human review/commit staging (no push).
- MCP-like: Project search/Rails intel/code analysis/VC/runtime as tool calls.

### Safety Policy (Canonical)
- Out-of-process sandbox (`tmp/agent_sandbox/`)
- Deny-by-default allowlist
- No network beyond SmartProxy (and local-only tool execution)
- AI may create local commits only; human push/merge

### Model Discovery
- Preferred: SmartProxy `GET /v1/models` as source of truth for model ids.
- Fallback: ENV-configured model ids.
### Atomic PRDs Table
| Priority | Feature                                  | Status | Dependencies |
|----------|------------------------------------------|--------|--------------|
| 1 | 0010: CWA Persona & Safe Shell Toolkit   | Todo | Agent-05 |
| 2 | 0020: Task Log Template & Persistence    | Todo | #1 |
| 3 | 0030: MCP-Like Tools Integration         | Todo | #1-2 |
| 4 | 0040: Self-Debug Loop                    | Todo | #3 |
| 5 | 0050: Workflow Integration & Hybrid Handoff | Todo | #4 |

