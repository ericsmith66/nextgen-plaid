```markdown
# Vision: Knowledge Enrichment / RAG Layer

**Role**  
RAG provides codebase and docs context to agents (SAP first), augmenting prompts with relevant snippets to reduce hallucinations and ensure accuracy.

**Responsibilities**  
- Index knowledge_base/rag_source/ (code, reviewed PRDs, prompts).  
- Embed chunks using local sentence-transformer (all-MiniLM-L6-v2).  
- Store in db/vectors.db (SQLite).  
- Query for top 3-5 similar chunks on agent request.  
- Rebuild index via rake rag:build on changes.  
- Query via rake rag:query[q=...].

**Context Provided**  
- Files from rag_source/ (code/, prds/reviewed/, prompts/) – never summaries or tax docs.

**Output**  
- Text chunks for prompt injection (e.g., "Relevant context: [chunk1] [chunk2]").

**Human in Loop**  
- Manual rake rebuild; review embedded sources for privacy.

**Architectural Impact**  
- Local-only Python script for embedding (offline, no GPU needed).  
- Integrates with SmartProxy/SAP prompts; optional PGVector future.  
- Keeps index small – rebuild <1 min.

**Risks & Mitigations**  
- Index bloat: Limit to core folders; periodic cleanup.  
- Irrelevant results: Tune chunk size (400 tokens); fallback to file concat if needed.

**Related Epics & Dependencies**  
- RAG-CONTEXT epic (build/query integration).  
- Depends on: Stable knowledge_base structure.  
- Blocks: High-quality Grok/SAP output.
```